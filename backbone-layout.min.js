!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["backbone","underscore"],b):a.BackboneLayout=b(a.Backbone,a._)}(this,function(a,b){"use strict";var c=a.$,d=function(a,c){c||(c={}),this.id=b.uniqueId("managed_"),this.view=a,this.anchor=c.anchor,this.replace=c.replace},e=function(){var a=[],c={};this.register=function(b,e){e||(e={}),this.listenTo(b,"all",function(){this.trigger.apply(this,arguments)},this);var f=new d(b,e);a.push(f);var g=b.model;if(g){var h=g.cid;c[h]||(c[h]=[]),c[h].push(f)}},this.unRegister=function(d){var e=b.filter(a,function(a){return a.view.cid===d.cid})[0];a=b.without(a,e);var f;b.each(c,function(a,c,d){f=b.without(a,e),d[c]&&(d[c]=f)}),this.stopListening(d)},this.each=function(c,d){b.each(a,c,d)},this.getViews=function(){return b.map(a,function(a){return a.view})},this.getManagedViews=function(c){return c?b.filter(a,function(a){return a.view===c}):a},this.getViewsByModel=function(a){var d=c[a.cid];return d.length?b.map(d,function(a){return a.view}):[]},b.bindAll(this,"register","unRegister","getViews","getViewsByModel","each")};b.extend(e.prototype,a.Events);var f=a.View.extend({constructor:function(c){c||(c={}),c=b.clone(c),this.viewManager=new e,this.defaults&&b.defaults(c,b.result(this,"defaults")),c.serialize&&(this.serialize=c.serialize),this.options=c,a.View.prototype.constructor.call(this,c)},initialize:function(b){this.listenTo(this.viewManager,"all",function(){this.trigger.apply(this,arguments)},this),this.listenTo(this.viewManager,"remove",function(){},this),a.View.prototype.initialize.call(this,b)},registerView:function(a,b){b||(b={}),this.viewManager.register(a,b)},unRegisterView:function(a){this.viewManager.unRegister(a)},render:function(){return this.beforeRender&&this.beforeRender(),this.template&&this.$el.empty().append(this.template(this.serialize())),this.viewManager.each(function(a){var b=a.view;if(b.render(),a.anchor){var d=c(a.anchor,this.el);a.replace?d.replaceWith(b.el):d.html(b.el)}},this),this.afterRender&&this.afterRender(),this},close:function(){return this.viewManager.each(function(a){var b=a.view;b.close&&b.close(),this.unRegisterView(b)},this),this.trigger("close",this),this.unbind(),this.stopListening(),this.remove(),this.onClose&&this.onClose(),this},serialize:function(){return this.model?this.model.toJSON():{}}});return f});
//# sourceMappingURL=backbone-layout.map.js