!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["backbone","underscore"],b):a.BackboneLayout=b(a.Backbone,a._)}(this,function(a,b){"use strict";var c=a.$,d=function(a,c){c||(c={}),this.id=b.uniqueId("managed_"),this.view=a,this.name=c.name,this.anchor=c.anchor,this.replace=c.replace},e=function(){this._views=[],this._viewsByModel={},this._viewsByName={},this.register=function(a,b){b||(b={}),this.listenTo(a,"all",function(){this.trigger.apply(this,arguments)},this);var c=new d(a,b);this._views.push(c),c.name&&(this._viewsByName[c.name]=c);var e=a.model;if(e){var f=e.cid;this._viewsByModel[f]||(this._viewsByModel[f]=[]),this._viewsByModel[f].push(c)}},this.unRegister=function(a){var c=b.filter(this._views,function(b){return b.view.cid===a.cid})[0];this._views=b.without(this._views,c),c&&(this._viewsByName=b.omit(this._viewsByName,c.name));var d;b.each(this._viewsByModel,function(a,e,f){d=b.without(a,c),f[e]&&(f[e]=d)}),this.stopListening(a)},this.each=function(a,c){b.each(this._views,a,c)},this.getViews=function(){return b.map(this._views,function(a){return a.view})},this.getManagedViews=function(a){return a?b.filter(this._views,function(b){return b.view===a}):this._views},this.getViewsByModel=function(a){var c=this._viewsByModel[a.cid];return c.length?b.map(c,function(a){return a.view}):[]},this.getViewByName=function(a){return this._viewsByName[a]},b.bindAll(this,"register","unRegister","getViews","getViewsByModel","each")};b.extend(e.prototype,a.Events);var f=a.View.extend({constructor:function(c){c||(c={}),c=b.clone(c),this.viewManager=new e,this.defaults&&b.defaults(c,b.result(this,"defaults")),c.serialize&&(this.serialize=c.serialize),this.options=c,a.View.prototype.constructor.call(this,c)},initialize:function(b){this.listenTo(this.viewManager,"all",function(){this.trigger.apply(this,arguments)},this),this.listenTo(this.viewManager,"remove",function(){},this),a.View.prototype.initialize.call(this,b)},registerView:function(a,b){b||(b={}),this.viewManager.register(a,b)},unRegisterView:function(a){this.viewManager.unRegister(a)},getViewByName:function(a){var b=this.viewManager.getViewByName(a);return b?b.view:void 0},render:function(){return this.beforeRender&&this.beforeRender(),this.template&&this.$el.empty().append(this.template(this.serialize())),this.viewManager.each(function(a){var b=a.view;if(b.render(),a.anchor){var d=c(a.anchor,this.el);a.replace?d.replaceWith(b.el):d.html(b.el)}},this),this.afterRender&&this.afterRender(),this},close:function(){return this.viewManager.each(function(a){var b=a.view;b.close&&b.close(),this.unRegisterView(b)},this),this.trigger("close",this),this.unbind(),this.stopListening(),this.remove(),this.onClose&&this.onClose(),this},serialize:function(){return this.model?this.model.toJSON():{}}});return f});
//# sourceMappingURL=backbone-layout.map.js